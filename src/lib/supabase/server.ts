//DO NOT EDIT THIS FILE
import { createServerClient } from '@supabase/ssr';
import { ReadonlyRequestCookies } from 'next/dist/server/web/spec-extension/adapters/request-cookies';
import { cookies } from 'next/headers';

export const createClient = async (cookieStore?: ReadonlyRequestCookies) => {
  // Ensure cookieHandler is fully resolved before proceeding
  const cookieHandler = cookieStore ?? (await cookies());

  return createServerClient(
    process.env.NEXT_PUBLIC_SUPABASE_URL!,
    process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!,
    {
      cookies: {
        async get(name) {
          try {
            const cookie = await cookieHandler.get(name); // Await the get call
            return cookie?.value ?? ''; // Use nullish coalescing for clarity
          } catch (error: unknown) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            console.warn(`[@supabase:server] Could not get cookie ${name}: ${errorMessage}`);
            return '';
          }
        },
        async set(name, value, options) {
          try {
            await cookieHandler.set(name, value, options); // Await the set call
          } catch (error: unknown) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            console.warn(`[@supabase:server] Could not set cookie ${name}: ${errorMessage}`);
          }
        },
        async remove(name, options) {
          try {
            await cookieHandler.set(name, '', { ...options, maxAge: 0 }); // Await the remove call
          } catch (error: unknown) {
            const errorMessage = error instanceof Error ? error.message : 'Unknown error';
            console.warn(`[@supabase:server] Could not remove cookie ${name}: ${errorMessage}`);
          }
        },
      },
    },
  );
};
